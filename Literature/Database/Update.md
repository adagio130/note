#postgresql

- **查詢解析與執行計劃**
    - PostgreSQL 解析 `UPDATE` 語句並生成執行計劃。
    - 決定如何掃描表（如使用索引或全表掃描）。
- **快照建立與可見性檢查**
    - PostgreSQL 根據事務的快照 (Snapshot) 確定哪些行對當前事務是可見的。
    - 遍歷符合 `WHERE` 條件的行進行處理。
- **加鎖與版本控制**
    - **行級鎖**：
        - 為符合條件的行加上排他鎖，防止其他事務同時修改這些行。
    - **行版本化**：
        - 創建新的行版本，寫入更新後的數據。
        - 舊的行版本被標記為無效，但不會立即刪除。
- **索引更新**
    - 如果更新的列有索引，則會：
        - 刪除舊行對應的索引條目。
        - 插入新行對應的索引條目。
- **WAL 日誌寫入**
    - 將更新操作記錄到 WAL（Write-Ahead Logging）日誌中，確保數據在崩潰後可恢復。
- **事務提交或回滾**
    - **提交**：
        - 如果事務提交，新的行版本對其他事務變得可見。
    - **回滾**：
        - 如果事務回滾，新的行版本被丟棄，舊行版本仍然有效。
- **垃圾回收**
    - 被標記為無效的舊行版本不會立即刪除，而是等待 `VACUUM` 或自動清理程序回收。